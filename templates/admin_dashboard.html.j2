{% extends "base.html.j2" %}
{% block title %}Admin Dashboard - CuraVie{% endblock %}

{% block content %}
<h1 style="text-align:center; margin-bottom: 30px;">CuraVie Admin Dashboard</h1>

<div class="container">
    <section class="dashboard-stats" style="margin-bottom: 40px;">
        <h2>Platform Statistics</h2>
        <p><strong>Total Registered Users:</strong> {{ total_users }}</p>
        <p><strong>Total Registered Hospitals & Clinics:</strong> {{ total_hospitals }}</p>
    </section>
    <section id="add-user-container" style="margin-bottom: 50px;">
        <h2>Create a New User</h2>
        <form method="POST" novalidate>
            {{ form.csrf_token }}
            <div class="form-group">
                {{ form.username.label(class='label-class') }}
                {{ form.username(class="form-input", placeholder="Enter Username") }}
                {% for e in form.username.errors %}<div class="error">{{ e }}</div>{% endfor %}
            </div>
            <div class="form-group">
                {{ form.email.label(class='label-class') }}
                {{ form.email(class="form-input", placeholder="Enter Email") }}
                {% for e in form.email.errors %}<div class="error">{{ e }}</div>{% endfor %}
            </div>
            <div class="form-group">
                {{ form.password.label(class='label-class') }}
                {{ form.password(class="form-input", placeholder="Enter Password") }}
                {% for e in form.password.errors %}<div class="error">{{ e }}</div>{% endfor %}
            </div>
            <div class="form-group">
                {{ form.role.label(class='label-class') }}
                {{ form.role(class="form-input", placeholder="Enter Role") }}
                {% for e in form.role.errors %}<div class="error">{{ e }}</div>{% endfor %}
            </div>
            {{ form.submit(class="btn-primary") }}
        </form>
    </section>
<hr>
<div id="add-facility-container">
    <h2>Add New Healthcare Facility</h2>
    <form method="POST" novalidate>
        {{ facility_form.csrf_token }}

        <div class="form-group">
            {{ facility_form.facility_name.label(class='label-class') }}
            {{ facility_form.facility_name(class='form-input', placeholder='Enter facility name') }}
            {% for e in facility_form.facility_name.errors %}
                <div class="error">{{ e }}</div>
            {% endfor %}
        </div>

        <div class="form-group">
            {{ facility_form.facility_type.label(class='label-class') }}
            {{ facility_form.facility_type(class='form-input', placeholder='Clinic, Hospital, CHC...') }}
            {% for e in facility_form.facility_type.errors %}
                <div class="error">{{ e }}</div>
            {% endfor %}
        </div>

        <div class="form-group">
            {{ facility_form.facility_license_number.label(class='label-class') }}
            {{ facility_form.facility_license_number(class='form-input', placeholder='Enter license number') }}
            {% for e in facility_form.facility_license_number.errors %}
                <div class="error">{{ e }}</div>
            {% endfor %}
        </div>

        <div class="form-group">
            {{ facility_form.facility_address.label(class='label-class') }}
            {{ facility_form.facility_address(class='form-input', placeholder='Enter facility address') }}
            {% for e in facility_form.facility_address.errors %}
                <div class="error">{{ e }}</div>
            {% endfor %}
        </div>

        <div class="form-group">
            {{ facility_form.facility_city.label(class='label-class') }}
            {{ facility_form.facility_city(class='form-input', placeholder='Enter city name') }}
            {% for e in facility_form.facility_city.errors %}
                <div class="error">{{ e }}</div>
            {% endfor %}
        </div>

        {{ facility_form.submit(class='btn-primary') }}
    </form>
</div>

<hr>

    <hr>
     <section style="margin-top: 2rem;">
        <h3>Search User</h3>
        <form method="GET" action="{{ url_for('admin_dashboard') }}" style="margin-bottom: 1rem; display: flex; gap: 10px;">
            <input type="text" name="search" class="form-input" placeholder="Enter username" value="{{ search_query }}" style="flex: 1;">
            <button type="submit" class="btn btn-primary">Search</button>
        </form>

        {% if search_results %}
        <table style="width: 100%; border-collapse: collapse; text-align: left;">
            <thead style="background-color: #f0f0f0;">
                <tr>
                    <th style="padding: 8px;">Username</th>
                    <th style="padding: 8px;">Email</th>
                    <th style="padding: 8px;">Role</th>
                    <th style="padding: 8px;">Created On</th>
                </tr>
            </thead>
            <tbody>
                {% for user in search_results %}
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 8px;">{{ user.username }}</td>
                    <td style="padding: 8px;">{{ user.email }}</td>
                    <td style="padding: 8px; text-transform: capitalize;">
                            {% if user.role.name == "ADMIN" %}
                                Admin
                            {% elif user.role.name == "NORMAL_USER" %}
                                Worker
                            {% elif user.role.name == "HEALTH_OFFICIAL" %}
                                HEALTH_OFFICIAL
                            {% else %}
                                Role not specified
                            {% endif %}
                    </td>
                    <td style="padding: 8px;">{{ user.created_at.strftime('%Y-%m-%d') if user.created_at else 'N/A' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% elif search_query %}
        <p style="color: red;">No users found for "<strong>{{ search_query }}</strong>"</p>
        {% endif %}
    </section>

</div>
{% endblock %}