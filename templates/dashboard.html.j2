{% extends "base.html.j2" %}
{% block title %}Dashboard - CuraVie{% endblock %}

{% block body_class %}dashboard-page{% endblock %}

{% block content %}

{% if current_user.worker %}
<div class="dashboard-hero">
    <div class="container">
        <h1 class="dashboard-title">
            <span data-translate-key="dashboard_welcome">Welcome</span>, 
            <strong>{{ current_user.username }}</strong> !
        </h1>
    </div>
</div>

<div class="container dashboard-container">
<div class="profile-card">
    <div class="profile-header">
        <!-- Avatar Link -->
        <img src="https://cdn-icons-png.flaticon.com/512/1077/1077114.png" 
             alt="User Avatar" class="profile-avatar">

        <div class="profile-info">
            <h2>{{ current_user.worker.first_name }} {{ current_user.worker.last_name }}</h2>
            <p>{{ current_user.worker.occupation.value }}</p>
        </div>
    </div>
    <div class="profile-details">
        <div class="detail-item">
            <i data-lucide="calendar"></i>
            <span>Age:</span> <strong>{{ current_user.worker.age }}</strong>
        </div>
        <div class="detail-item">
            <i data-lucide="map-pin"></i>
            <span>Home State:</span> <strong>{{ current_user.worker.home_state }}</strong>
        </div>
        <div class="detail-item">
            <i data-lucide="phone"></i>
            <span>Phone:</span> <strong>{{ current_user.worker.phone }}</strong>
        </div>
        <div class="detail-item">
            <i data-lucide="flame"></i>
            <span>Smoking Habit:</span> <strong>{{ current_user.worker.smoking_habit.value }}</strong>
        </div>
    </div>
</div>
    <!-- Actions Card -->
    <div class="card actions-card">
        <div class="card-header">
            <h2 data-translate-key="dashboard_actions_title">Actions</h2>
        </div>
        <div class="action-buttons">
            <a href="{{ url_for('edit_details') }}" class="btn btn-primary"><span>✏️</span> Edit Details</a>
            <a href="{{ url_for('add_health_record') }}" class="btn btn-primary"><span>➕</span> Add Health Record</a>
            <a href="{{ url_for('log_activity') }}" class="btn btn-primary"><span>📋</span> Log Activity</a>
            <a href="{{ url_for('add_vaccination') }}" class="btn btn-primary"><span>💉</span> Vaccination</a>
        </div>
    </div>

<div class="card ai-report-card">
    <div class="ai-report-content">
        <h2 data-translate-key="dashboard_ai_report_title">AI Health Assessment</h2>
        <p data-translate-key="dashboard_ai_report_description">
            Get a personalized health risk assessment and recommendations based on your profile.
        </p>
        <a href="{{ url_for('generate_report') }}" id="generate-report-btn" class="btn btn-action-primary mt-3">
            <span>📄</span> Generate & Download Report
        </a>
    </div>
    <div class="ai-report-icon">
    <img src="https://cdn-icons-png.flaticon.com/512/2910/2910764.png" alt="Graph Icon" class="ai-icon-img">
</div>
</div>

</div>

{% else %}
<div class="container empty-dashboard">
    <div class="card no-profile-cta">
        <h2 data-translate-key="dashboard_get_started">Let’s Get Started</h2>
        <p data-translate-key="dashboard_no_details">
            You haven’t created your profile yet. Fill in your details to unlock all CuraVie features.
        </p>
        <a href="{{ url_for('worker_details') }}" class="btn btn-primary">
            🌼 Create Your Profile Now
        </a>
    </div>
</div>
{% endif %}

<div id="report-generating-notification" class="flash-message info" style="display:none;position:fixed;bottom:20px;right:20px;z-index:2000;">
    Generating your health report... This may take a moment.
</div>

<script>
const generateBtn = document.getElementById('generate-report-btn');
const notification = document.getElementById('report-generating-notification');
if (generateBtn) {
    generateBtn.addEventListener('click', () => {
        notification.style.display = 'block';
    });
}
</script>

{% endblock %}